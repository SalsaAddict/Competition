var comp=angular.module("Competition",["ui.bootstrap"]),SSC,Competition;(function(n){var t=function(){function n(n,t){this.$filter=n;this.$log=t;this.competition={name:"Skating System Example",divisions:[{name:"Salsa Couples",judges:["John","Paul","Ringo","George","Beyonc√©","Kelly","Michelle"],competitors:[{id:"53",name:"Ross & Rachel"},{id:"51",name:"Bonnie & Clyde"},{id:"52",name:"Fred & Ginger"},{id:"54",name:"Mork & Mindy"},{id:"55",name:"Sheldon & Amy"}],results:[[1,1,1,1,1,1,1],[2,2,2,2,2,2,2],[3,3,3,3,3,3,3],[4,4,4,4,4,4,4],[5,5,5,5,5,5,5]]},{name:"Bachata Couples",judges:[],competitors:[],results:[]}]}}return Object.defineProperty(n.prototype,"judges",{get:function(){if(angular.isDefined(this.division))return angular.isArray(this.division.judges)?this.division.judges:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"x",{get:function(){return angular.isArray(this.judges)?this.judges.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"competitors",{get:function(){if(angular.isDefined(this.division))return angular.isArray(this.division.competitors)?this.$filter("orderBy")(this.division.competitors,"id"):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return angular.isArray(this.competitors)?this.competitors.length:0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"results",{get:function(){if(angular.isDefined(this.division))return angular.isArray(this.division.results)?this.division.results:void 0},enumerable:!0,configurable:!0}),n.prototype.$postLink=function(){angular.isDefined(this.competition)&&angular.isArray(this.competition.divisions)&&(this.division=this.competition.divisions[0])},n.$inject=["$filter","$log"],n}(),i;n.Controller=t,function(n){function i(){return function(){return{restrict:"A",controller:t,bindToController:{results:"="},require:{ngModel:"ngModel"}}}}var t=function(){function n(n){this.$element=n}return n.prototype.$postLink=function(){var n=this;this.ngModel.$parsers.push(function(t){var i;if(/^([1-8])$/.test(t)&&(i=parseInt(t,10),i<=n.results.length))return n.$element.removeClass("is-invalid").addClass("is-valid"),i;n.$element.removeClass("is-valid").addClass("is-invalid");return})},n.$inject=["$element"],n}();n.Controller=t;n.DirectiveFactory=i}(i=n.Results||(n.Results={}))})(SSC||(SSC={})),function(n){"use strict";var t=function(){function n(n,t){this.$filter=n;this.$log=t;this.judges=["A","B","C","D","E","F","G"];this.competitors=[{id:71,name:"71",results:[3,1,6,1,1,2,1]},{id:72,name:"72",results:[2,2,1,5,3,1,3]},{id:73,name:"73",results:[1,5,4,2,2,6,2]},{id:74,name:"74",results:[5,4,2,4,6,5,4]},{id:75,name:"75",results:[4,6,3,3,5,4,6]},{id:76,name:"76",results:[6,3,5,6,4,3,5]}];this._calculated=!1}return Object.defineProperty(n.prototype,"competitorsById",{get:function(){return this.$filter("orderBy")(this.competitors,"id")},enumerable:!0,configurable:!0}),n.prototype.judgeResults=function(n){var i=this.judges.indexOf(n),t=[];return this.competitorsById.forEach(function(n){t.push(n.results[i]||null)}),t},n.prototype.isValidResult=function(n,t){var i=n[t]||null;return i===null?!1:i<1?!1:i>this.competitors.length?!1:n.indexOf(i,t+1)>-1?!1:!0},n.prototype.isValidJudge=function(n){for(var i=!0,r=this.judgeResults(n),t=0;t<r.length;t++)if(!this.isValidResult(r,t)){i=!1;break}return i},n.prototype.isValidCompetitor=function(n){for(var i=!0,t=0;t<this.judges.length;t++)if(!this.isValidResult(this.judgeResults(this.judges[t]),n)){i=!1;break}return i},n.prototype.isValid=function(){for(var t=!0,n=0;n<this.judges.length;n++)if(!this.isValidJudge(this.judges[n])){t=!1;break}return t},n.prototype.tally=function(){var n=this;this.competitors.forEach(function(t){var r,i;for(t.tally=[],r=function(i){var r={majority:!1,count:0,sum:0};t.results.forEach(function(n){n<=i+1&&(r.count++,r.sum+=n)});r.count>=n.majority&&(r.majority=!0);t.tally.push(r)},i=0;i<n.competitors.length;i++)r(i)})},n.prototype.ranked=function(){for(var n=[],i=function(t){n.push(function(n){var i=n.tally[t];return i.majority?-i.count:null});n.push(function(n){var i=n.tally[t];return i.majority?i.sum:null})},t=0;t<this.competitors.length;t++)i(t);return this.$log.debug("predicates",n),this.$filter("orderBy")(this.competitors,n)},Object.defineProperty(n.prototype,"majority",{get:function(){return Math.ceil(this.judges.length/2)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"calculated",{get:function(){return this._calculated},enumerable:!0,configurable:!0}),n.prototype.calculate=function(){this.tally();this.ranked().forEach(function(n,t){n.rank=t+1});this._calculated=!0},n.prototype.download=function(){var t="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(this.competitors)),n=document.createElement("a");n.setAttribute("href","data:"+t);n.setAttribute("download","competition.json");n.click()},n.prototype.$postLink=function(){},n.$inject=["$filter","$log"],n}(),i;n.Controller=t,function(n){function i(){return function(){return{restrict:"A",controller:t,bindToController:{max:"=rankInput"},require:{ngModel:"^ngModel"}}}}var t=function(){function n(){}return n.prototype.$postLink=function(){var n=this;this.ngModel.$parsers.unshift(function(n){return parseInt(n,10)});this.ngModel.$validators.min=function(n){return n>=1};this.ngModel.$validators.max=function(t){return t<=n.max}},n}();n.Controller=t;n.DirectiveFactory=i}(i=n.RankInput||(n.RankInput={}))}(Competition||(Competition={}));comp.controller("competitionController",SSC.Controller);comp.directive("results",SSC.Results.DirectiveFactory());