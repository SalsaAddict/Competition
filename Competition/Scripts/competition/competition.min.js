var comp=angular.module("Competition",["ui.bootstrap"]),SSC;(function(n){var t=function(){function n(n,t){this.$filter=n;this.$log=t;this.competition={name:"Skating System Example",divisions:[{name:"Salsa Couples",judges:["John","Paul","Ringo","George","Beyonc√©","Kelly","Michelle"],competitors:[{id:"71",name:"Ross & Rachel"},{id:"72",name:"Bonnie & Clyde"},{id:"73",name:"Fred & Ginger"},{id:"74",name:"Mork & Mindy"},{id:"75",name:"Sheldon & Amy"},{id:"76",name:"Romeo & Juliet"}],results:[[1,5,4,2,2,6,2],[4,6,3,3,5,4,6],[5,4,2,4,6,5,4],[3,1,6,1,1,2,1],[2,2,1,5,3,1,3],[6,3,5,6,4,3,5]]},{name:"Bachata Couples",judges:[],competitors:[],results:[]}]};this.tab=this.tabs[0]}return Object.defineProperty(n.prototype,"judges",{get:function(){if(angular.isDefined(this.division))return angular.isArray(this.division.judges)?this.division.judges:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"competitors",{get:function(){if(angular.isDefined(this.division))return angular.isArray(this.division.competitors)?this.$filter("orderBy")(this.division.competitors,"id"):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"results",{get:function(){if(angular.isDefined(this.division))return angular.isArray(this.division.results)?this.division.results:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"calculated",{get:function(){return angular.isDefined(this.division)?this.division.calculated||!1:!1},enumerable:!0,configurable:!0}),n.prototype.calculate=function(){var i=this,u=Math.ceil(this.judges.length/2),n,r,t;for(this.competitors.forEach(function(n,t){var r,f,o,e,s;for(n.tally=[],r=0;r<i.competitors.length;r++){for(f=0,o=0,e=0;e<i.judges.length;e++)s=i.results[t][e],s<=r+1&&(f++,o+=s);f>=u?n.tally.push(f,o):n.tally.push(null,null)}}),n=[],r=function(t){n.push(function(n){return-n.tally[t*2]||null});n.push(function(n){return n.tally[t*2+1]||null})},t=0;t<this.competitors.length;t++)r(t);this.$filter("orderBy")(this.competitors,n).forEach(function(n,t){n.rank=t+1});this.division.calculated=!0;this.tab=this.tabs[2]},n.prototype.edit=function(){delete this.division.calculated},n.prototype.rank=function(n){return["1st","2nd","3rd","4th","5th","6th","7th","8th"][n-1]},Object.defineProperty(n.prototype,"tabs",{get:function(){return["Scoring","Calculation","Results"]},enumerable:!0,configurable:!0}),n.prototype.setTab=function(n,t){(t.preventDefault(),t.stopPropagation(),!this.tabs.indexOf(n)||this.calculated)&&(this.tab=n)},n.prototype.$postLink=function(){angular.isDefined(this.competition)&&angular.isArray(this.competition.divisions)&&(this.division=this.competition.divisions[0])},n.$inject=["$filter","$log"],n}(),i;n.Controller=t,function(n){function i(){return function(){return{restrict:"A",controller:t,controllerAs:"$results",bindToController:{results:"="},require:{ngModel:"ngModel"}}}}var t=function(){function n(n,t,i){this.$scope=n;this.$element=t;this.$timeout=i}return Object.defineProperty(n.prototype,"x",{get:function(){return this.$scope.$index},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this.$scope.$parent.$index},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.results[this.y][this.x]},set:function(n){this.results[this.y][this.x]=n},enumerable:!0,configurable:!0}),n.prototype.setValidity=function(){var n=this;this.$timeout(function(){n.ngModel.$valid?n.$element.removeClass("is-invalid").addClass("is-valid"):n.$element.removeClass("is-valid").addClass("is-invalid")})},n.prototype.$postLink=function(){var n=this;this.ngModel.$parsers.push(function(t){if(n.ngModel.$isEmpty(t))return t;if(/^([1-8])$/.test(t))return parseInt(t,10)});this.ngModel.$validators.max=function(t){return t<=n.results.length};this.ngModel.$validators.duplicate=function(t){for(var r=!0,i=0;i<n.results.length;i++)if(t==n.results[i][n.x]&&i!==n.y){r=!1;break}return r};this.ngModel.$viewChangeListeners.push(function(){n.setValidity()});this.setValidity()},n.$inject=["$scope","$element","$timeout"],n}();n.Controller=t;n.DirectiveFactory=i}(i=n.Results||(n.Results={}))})(SSC||(SSC={}));comp.controller("competitionController",SSC.Controller);comp.directive("results",SSC.Results.DirectiveFactory());